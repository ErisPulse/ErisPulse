name: 'ğŸ€ è‰¾è‰ä¸çš„é­”æ³•é‚®ä»¶æœåŠ¡ ~'
description: 'é€šè¿‡ Resend å‘é€é­”æ³•ç”µå­é‚®ä»¶é€šçŸ¥'
inputs:
  subject:
    type: string
    default: '[è‰¾è‰ä¸å¿«æŠ¥] é»˜è®¤ä¸»é¢˜'
    description: 'é‚®ä»¶ä¸»é¢˜'
  content:
    type: string
    required: true
    description: 'é‚®ä»¶æ­£æ–‡å†…å®¹'
  recipients:
    type: json
    required: true
    description: 'æ”¶ä»¶äººåˆ—è¡¨ JSON æ•°ç»„'
  resend_api_key:
    type: string
    required: true
    description: 'Resend API å¯†é’¥'

runs:
  using: "composite"
  steps:
    - name: å®‰è£…ä¾èµ–
      run: python -m pip install requests
      shell: bash

    - name: å‘é€é‚®ä»¶
      env:
        RECIPIENTS_JSON: ${{ inputs.recipients }}
        SUBJECT: ${{ inputs.subject }}
        CONTENT: ${{ inputs.content }}
        RESEND_API_KEY: ${{ inputs.resend_api_key }}
      run: |
        cat << EOF > send_mail.py
        import requests
        import os
        import json

        recipients = json.loads(os.getenv("RECIPIENTS_JSON"))
        resend_api_key = os.getenv("RESEND_API_KEY")
        subject = os.getenv("SUBJECT")
        content = os.getenv("CONTENT")
        print(f"ğŸ“¬ æ”¶ä»¶äººåˆ—è¡¨: {recipients}")
        response = requests.post(
            "https://api.resend.com/emails",
            headers={
                "Authorization": f"Bearer {resend_api_key}",
                "Content-Type": "application/json"
            },
            json={
                "from": "ErisPulse <noreply@anran.xyz>",
                "to": recipients,
                "subject": subject,
                "html": content
            }
        )

        if response.status_code == 200:
            print("ğŸ’Œ é­”æ³•ä¿¡ä»¶å·²æˆåŠŸå¯„å‡ºï¼")
        else:
            print(f"âŒ å‘é€å¤±è´¥: {response.text}")
            exit(1)
        EOF

        python send_mail.py
      shell: bash